<tl-card
   *ngIf="!this.place.isUndefined()"
   class="tl-xbig-bottom-margined"
   [size]="'tl-xbig'"
   [tlStyle]="'tl-no-bg-outlined'"
   [padding]="20">

	<!-- Place title -->
	<div
	  class="tl-title tl-big-bottom-margined">
	  {{ this.place.name }}
	</div>

	<!-- Place Search Bar -->
	<tl-input
	  class="tl-big-bottom-margined"
	  [size]="'tl-near-full-responsive'"
	  [tlStyle]="'tl-glassmorphic'"
	  [placeholder]="'Rechercher un lot'"
    [lingeringPlaceholder]="true"
	  [icon]="'ion-search-outline'"
	  [height]="50"
	  [validationOn]="false"
	  (changeValue)="this.searchBatch($event)">
	</tl-input>
	
</tl-card>

<!-- Display loader if place is not resolved yet -->
<tl-loader
  *ngIf="this.place.isUndefined() || !this.place.areBatchesResolved">
</tl-loader>

<!-- Batches panel -->
<div
  *ngIf="!this.place.isUndefined() && this.place.areBatchesResolved"
  class="tl-full tl-row-dir tl-hor-center tl-flex-block">
  
  <div
    *ngIf="this.displayedBatches.length == 0">
    Aucun lot trouvé
  </div>
  
  <div
    *ngFor="let batch of this.displayedBatches"
    class="batch-card tl-margined tl-big tl-soft-transparent tl-container-flex-block tl-big-padded">
   
    <div
      class="tl-full tl-row-dir tl-vert-center tl-hor-space-between tl-no-wrap tl-flex-block">
        
      <div
        class="tl-subtitle tl-flex-grow tl-ellipsis"
        style="margin-right:10px">
        {{ batch.name }}
      </div>
      
      <div
        class="tl-row-dir tl-vert-center tl-no-wrap tl-flex-block">
      
        <tl-icon-toggler
          class="tl-margined" 
          [size]="30"
          [icon]="'ion-heart-outline'"
          [iconOn]="'ion-heart'"
          [initialState]="batch.favorite"
          (toggle)="this.onChangeFavoriteFlag(batch, $event)">
        </tl-icon-toggler>
        
        <tl-square-icon
          style="cursor:pointer"
          class="tl-margined"
          [size]="30"
          [icon]="'ion-create-outline'"
          (click)="this.onClickBatchEdit(batch)">
        </tl-square-icon>
        
        <tl-square-icon
          style="cursor:pointer"
          class="tl-margined"
          [size]="30"
          [icon]="'ion-trash-outline'">
        </tl-square-icon>
        
      </div>
      
    </div>
    
    <div
      class="tl-full tl-row-dir tl-vert-center tl-hor-space-between tl-flex-block">
     
	    <tl-gauge
	      class="tl-flex-grow"
	      [tlStyle]="'tl-soft-transparent'"
	      [size]="'tl-fit-content'"
	      [min]="0"
	      [low]="batch.lowLimitQuantity"
	      [high]="batch.goodQuantity"
	      [max]="batch.highestQuantity"
	      [current]="batch.quantity">
	    </tl-gauge>
    
	    <div
	      style="margin-left:10px"
	      class="tl-row-dir tl-vert-center tl-flex-block">
	      
	      <tl-button
	        [tlStyle]="'tl-dome'"
	        [size]="30"
	        [icon]="'ion-remove-outline'"
	        (clickButton)="onClickBatchRemove(batch)">
	      </tl-button>
	      
	      <tl-button
	        [tlStyle]="'tl-dome'"
          [size]="30"
	        [icon]="'ion-add-outline'"
	        (clickButton)="onClickBatchAdd(batch)">
	      </tl-button>
	      
	    </div>
	    
	  </div>
    
  </div>
  
</div>

<a
  *ngIf="this.showLoadMoreButton"
  class="tl-big-margined"
  (click)="this.onClickShowMore()">
  Voir plus
</a>

<!-- Button to add a new batch -->
<div
  *ngIf="!this.place.isUndefined()"
  class="new-batch-button tl-row-dir tl-vert-center tl-no-wrap tl-flex-block">
  
  <div
    style="margin-right:10px"
    class="new-batch-button-label"
    [class.hidden]="this.newBatchButtonLabelStatus === 1"
    [class.none]="this.newBatchButtonLabelStatus === 2">
    Ajouter un lot
  </div>
  
	<tl-button
	  [tlStyle]="'tl-glassmorphic'"
	  [size]="60"
	  [icon]="'ion-add-outline'"
	  [color]="'tl-success'"
	  (clickButton)="this.displayNewBatchPopup = true">
	</tl-button>
	
</div>

<!-- Popup to create new batch -->
<tl-popup-overlay
  [display]="this.displayNewBatchPopup"
  [tlStyle]="'tl-sharp-transparent'"
  (close)="this.onClickClosePopup()">
  
  <!-- Popup to display -->
  <tl-card
    style="overflow:visible"
    [tlStyle]="'tl-outlined'"
    [size]="'tl-two-third-responsive'"
    [padding]="20">
    
    <tl-form
      *ngIf="this.displayNewBatchPopup"
		  [form]="{
		      items: [
		          {
		            id: 'batch-name',
		            type: 'input-text',
		            label: 'Nom du lot',
                icon: 'ion-pricetag-outline',
                initialValue: this.editedBatch.name
		          },
              {
                id: 'batch-category',
                type: 'select',
                label: 'Cat�gorie',
                proposals: [{ name: 'F�culent' },{name: 'Huile'},{name: 'Sucre'},{name: 'Gateaux'},{name: 'Alcool'},{name: 'Noix'},{name: 'Conserve'},{name: 'Epices'}],
                initialValue: this.editedBatch.category
              },
		          {
		            id: 'batch-favorite',
		            type: 'toggler',
		            label: 'Favori',
                initialValue: this.editedBatch.favorite
		          },
              {
                id: 'batch-quantity',
                type: 'input-text',
                label: 'Quantité',
                icon: 'ion-speedometer-outline',
                validationFilter: 'integer',
                validationMessage: 'Le contenu doit être un n ombre entier positif',
                initialValue: this.editedBatch.quantity
              },
              {
                id: 'batch-good-quantity',
                type: 'input-text',
                label: 'Quantité cible minimum',
                icon: 'ion-battery-half-outline',
                validationFilter: 'integer',
                validationMessage: 'Le contenu doit être un n ombre entier positif',
                initialValue: this.editedBatch.goodQuantity
              },
              {
                id: 'batch-highest-quantity',
                type: 'input-text',
                label: 'Quantité cible maximum ',
                icon: 'ion-battery-full-outline',
                validationFilter: 'integer',
                validationMessage: 'Le contenu doit être un n ombre entier positif',
                initialValue: this.editedBatch.highestQuantity
              },
              {
                id: 'batch-low-quantity',
                type: 'input-text',
                label: 'Quantité minimale',
                icon: 'ion-battery-dead-outline',
                validationFilter: 'integer',
                validationMessage: 'Le contenu doit être un n ombre entier positif',
                initialValue: this.editedBatch.lowLimitQuantity
              },
              {
                id: 'batch-weight',
                type: 'input-text',
                label: 'Poids d\'un produit (kg)',
                icon: 'ion-barbell-outline',
                validationFilter: 'number',
                validationMessage: 'Le contenu doit être un nombre decimal (poids en kg)',
                initialValue: this.editedBatch.weight
              },
              {
                id: 'batch-energy',
                type: 'input-text',
                label: 'Nombre de calories/kg',
                icon: 'ion-flame-outline',
                validationFilter: 'integer',
                validationMessage: 'Le contenu doit être un entier positif',
                initialValue: this.editedBatch.energy
              },
              {
                id: 'batch-price',
                type: 'input-text',
                label: 'Prix par produit',
                icon: 'ion-cash-outline',
                validationFilter: 'number',
                validationMessage: 'Le contenu doit être un nombre décimal (prix en euros)',
                initialValue: this.editedBatch.price
              }
		        ],
		      button: {
		        label: (this.editedBatch.id == undefined)?'Créer':'Modifier',
		        icon: 'ion-send-outline'
		      }
		    }"
		  [size]="'tl-half-responsive'"
		  [itemsBorderRadius]="'tl-br-infinite'"
		  [primaryStyle]="'tl-neumorphic-inset-sharp'"
		  [secondaryStyle]="'tl-neumorphic'"
		  [submitButtonLoadingStatus]="this.newBatchPopupLoadingStatus"
		  (submitForm)="this.submitBatchForm($event)">
		</tl-form>
    
  </tl-card>

</tl-popup-overlay>